# Pydantic + JSONForms Demo (Portfolio)

## Overview
This demo shows how to use a nested Pydantic model as the single source of truth for validation and how to expose a JSON Schema for JSONForms. It also includes a FastAPI endpoint that validates form input using the same Pydantic model.

## Files
- `app.py`: Pydantic models + FastAPI app.
- `notes.md`: Work log.

## Key Questions

### 1) Can the form validation just be defined in Pydantic or does it need to be defined twice?
You can define validation once in Pydantic and **generate JSON Schema** from the model, which JSONForms can consume. This avoids duplicating most validation logic (types, required fields, min/max, enum, etc.).

However, JSONForms also uses **UI schema** for layout and presentation, which is not provided by Pydantic. If you want custom layout (grouping, labels, help text, ordering), you will still define a UI schema separately. Additionally, complex runtime validators (like cross-field comparisons) may not always map perfectly to JSON Schema, so you might expose custom errors from your FastAPI endpoint for those cases.

### 2) How can the user of the form define the number of projects to create?
In Pydantic, the `projects` array uses `min_length=1` and `max_length=6`. JSON Schema will expose this as `minItems` and `maxItems`. JSONForms will use those bounds to allow users to add/remove items within that range.

If you want the user to choose the number up front (e.g., “Create 3 projects”), you can:
- Add a separate field like `project_count` in the model and use UI schema rules to control array length in the UI, or
- Provide UI logic in your JSONForms integration (outside of Pydantic) that pre-creates N items when the form is initialized.

## Pydantic Models (Highlights)
- Nested models: `Portfolio` → `Project` → `ProjectMeta`.
- Validations:
  - Email format with `EmailStr`.
  - URL format with `HttpUrl`.
  - Date ordering (`end_date >= start_date`).
  - Conditional rule: completed projects must have `end_date`.
  - Unique, normalized tags.
  - Array length constraints for `projects` and `contributors`.

## Running the API

```bash
pip install fastapi uvicorn "pydantic[email]"
uvicorn app:app --reload
```

The API exposes:
- `POST /validate` – Validates payloads against the Pydantic model.
- `GET /schema` – Returns JSON Schema generated by Pydantic (use this in JSONForms).

## JSONForms Client Demo
The `jsonforms-client/` folder includes a tiny browser demo that:
1. Fetches the JSON Schema from `GET /schema`.
2. Renders the form with JSONForms vanilla renderers.
3. Sends the form data to `POST /validate` for server-side validation.

### Run the demo
Start the API in one terminal:

```bash
uvicorn app:app --reload
```

Serve the client from another terminal (the demo expects port `8001`):

```bash
python -m http.server 8001 --directory jsonforms-client
```

Then open <http://localhost:8001> in your browser and click **Validate with API**.

### Example Payload
```json
{
  "meta": {
    "title": "Q2 Portfolio",
    "owner_email": "owner@example.com",
    "created_on": "2024-06-01",
    "visibility": "team"
  },
  "projects": [
    {
      "meta": {
        "name": "Analytics Revamp",
        "status": "active",
        "start_date": "2024-03-01",
        "end_date": null,
        "budget_usd": 250000,
        "repo_url": "https://github.com/example/analytics",
        "tags": ["data", "etl"]
      },
      "summary": "Modernize the analytics pipeline and dashboards.",
      "contributors": ["Ada Lovelace", "Grace Hopper"]
    }
  ]
}
```

## JSONForms Usage (Minimal)
1. Fetch the schema from `GET /schema`.
2. Supply it to JSONForms as the `schema`.
3. Provide a basic UI schema like:

```json
{
  "type": "VerticalLayout",
  "elements": [
    {
      "type": "Group",
      "label": "Portfolio",
      "elements": [
        { "type": "Control", "scope": "#/properties/meta/properties/title" },
        { "type": "Control", "scope": "#/properties/meta/properties/owner_email" },
        { "type": "Control", "scope": "#/properties/meta/properties/visibility" }
      ]
    },
    {
      "type": "Group",
      "label": "Projects",
      "elements": [
        { "type": "Control", "scope": "#/properties/projects" }
      ]
    }
  ]
}
```

## Notes
See `notes.md` for work log.
